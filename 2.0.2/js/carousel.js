define("fb/carousel",["fb/jquery","fb/img-responsive/img-srcset","fb/window-events"],function(e,n,t){"use strict";var a=!1,s=[],i=function(){if(s.length>0)for(var e=s.length;e--;){var t=s[e].$image;if(t){var a=new n.get({srcset:s[e].srcset}),i=a.best.src;if(s[e].loaded===i)return;s[e].loaded=i,t.attr("src",i)}}},o=function(t,a){var i,o,r=[],c=!1,l=0,u="fb-carousel-in",f="fb-carousel-out",d=a.waiting||5e3,v=t.find(".fb-carousel-items"),b=e('<div class="fb-carousel-loading"></div>'),m=e('<ul class="fb-carousel-nav"></ul>'),h=null,p=e('<ul class="fb-carousel-text"></ul>'),g=null,w=function(n){r[l].$el.addClass(f).removeClass(u),r[n].$el.addClass(u).removeClass(f),e(g[l]).addClass(f).removeClass(u),setTimeout(function(){e(g[n]).removeClass(f).addClass(u),c=!1},700),e(h[l]).removeClass("fb-carousel-nav-active"),e(h[n]).addClass("fb-carousel-nav-active"),l=n},C=function(){b[0].style.display="none",M()},$=function(t){var a=r[t].loaded;if(D(),a)w(t);else{b[0].style.display="block";var i=e('<img class="fb-carousel-image" src="" />'),o=new n.get({srcset:r[t].srcset}),c=o.best&&o.best.src;if(!c)return C(),void w(t);i.prependTo(r[t].$el),i.load(function(){if(!r[t].loaded){var n=e(this);C(),r[t].loaded=o.best.src,r[t].$image=n,s.push(r[t]),w(t)}}).attr({src:c}).error(function(){C(),r[t].loaded=!0,w(t)})}},x=function(e){c=!0,$(e)},k=function(){v.find(".fb-carousel--item").each(function(){var n=e(this),t=n.attr("data-srcset"),a=n.find(".fb-carousel-content").detach();p.append('<li class="fb-carousel-text--item">'+a.html()+"</li>"),r.push({$el:n,srcset:t,loaded:!1,$image:null})}),o=r.length-1},y=function(){for(var e=[],n=0,a=r.length;n<a;n+=1){var s="fb-carousel-nav-item";0===n&&(s+=" fb-carousel-nav-active"),e.push('<li class="'+s+'"><span class="fb-carousel-bullet">'+n+"</span></li>")}m.append(e.join("")),h=m.find("li"),g=p.find(".fb-carousel-text--item"),t.append('<a href="#" class="fb-carousel-prev"></a><a href="#" class="fb-carousel-next"></a>',b,p),t.after(m)},T=function(e){!0!==c&&(e=e<0?o:e>o?0:e,x(e))},j=function(){if(t.on("click",".fb-carousel-prev",function(e){return e.preventDefault(),T(l-1),!1}),t.on("click",".fb-carousel-next",function(e){return e.preventDefault(),T(l+1),!1}),t.on("click",function(){var n=e(g[l]).find(".js-carousel-action").attr("href");window.location=n}),m.on("click",".fb-carousel-nav-item",function(n){n.preventDefault(),T(e(this).index())}),window.Modernizr&&window.Modernizr.touch){var n=0,s=0;t.on("touchstart",function(e){n=e.originalEvent.touches[0].clientX}),t.on("touchend",function(e){M(),s=e.originalEvent.changedTouches[0].clientX;var t;void 0!==(t=Math.abs(n-s)<=50?void 0:n>s?l+1:l-1)&&T(t)})}a.timer&&t.hover(D,M)},z=function(){T(l+1),M()},D=function(){a.timer&&clearTimeout(i)},M=function(){a.timer&&(i=setTimeout(z,d))};!function(){k(),y(),j(),$(0)}()};return{init:function(e,n){new o(e,n),a||(a=!0,t.onResize(i))}}});